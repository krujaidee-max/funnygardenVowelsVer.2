<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡πÄ‡∏Å‡∏°: ‡∏ï‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏Ñ‡∏≥ ‡πÄ-‡∏≤ </title>
<style>
/* ====================== ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡∏ù‡∏±‡∏á (‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà) ====================== */
@font-face{
  font-family: 'MyGameFont';
  src: url('image/THSarabunNew.woff2') format('woff2'),
       url('image/THSarabunNew.woff') format('woff'),
       url('image/THSarabunNew.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face{
  font-family: 'MyGameFont';
  src: url('image/THSarabunNewBold.woff2') format('woff2'),
       url('image/THSarabunNewBold.woff') format('woff'),
       url('image/THSarabunNewBold.ttf') format('truetype');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

/* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πà‡∏ß‡∏´‡∏ô‡πâ‡∏≤ */
html, body, button, input, select, textarea, .pill, .btn, .btn-mini,
.levelBtn, #startTitle, #countdown, .label, #timer {
  font-family: 'MyGameFont', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif;
}

/* >>> OVERRIDE: ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô */
#landing .brand{ width: min(92vw, 1100px); }
#landing .brand img{ max-height: 320px; object-fit: contain; }
#landing{ gap: 12px; }

/* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î */
@media (max-width: 480px){
  #landing .brand{ width: min(80vw, 360px); }
  #landing .brand img{ max-height: 100px; }
}

/* ====== Landing = ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô ====== */
#landing{
  position: fixed; inset: 0;
  display: flex; flex-direction: column; gap: 22px;
  align-items: center; justify-content: center;
  background: url("image/background3.png") center/cover no-repeat fixed !important;
  z-index: 20000; transition: opacity .3s ease;
}
#landing.hide{ opacity: 0; pointer-events: none; visibility: hidden; }
#landing .brand{ width: min(92vw, 1100px); }
#landing .brand img{ width:100%; height:auto; display:block; filter:drop-shadow(0 10px 30px rgba(0,0,0,.6)); }

/* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
.level-menu{
  display:flex; flex-direction:column; gap:14px; width:min(92vw, 640px);
}
.levelBtn{
  width:100%;
  padding: 10px 16px;
  font-size: clamp(20px, 4vw, 34px); font-weight: 1000; letter-spacing:.2px;
  border: 0; border-radius: 14px; color: #fff; background: rgba(0,0,0,.55);
  box-shadow: 0 10px 28px rgba(0,0,0,.35); cursor: pointer; text-align:center;
  border:1px solid rgba(255,255,255,.18); backdrop-filter: blur(6px);
}
.levelBtn:hover{ filter: brightness(1.08); }
.levelBtn:active{ transform: translateY(1px); }

/* ====== ‡∏ò‡∏µ‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ====== */
:root{ --glass: rgba(0,0,0,.45); --ok:#10b981; --bad:#ef4444; }
*{ box-sizing:border-box }
html,body{ height:100%; margin:0; }
body{
  background: url("image/background3.png") center/cover no-repeat fixed !important;
  overflow:hidden; color:#fff;
}
#game{ position:relative; width:100vw; height:100vh; overflow:hidden }

/* ‚úÖ ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö Zoom (PIP ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á) */
#camFull{
  position: fixed;
  left: 12px; bottom: 12px;
  width: 260px; height: 160px;
  z-index: 6; display: none;
  border:1px solid rgba(255,255,255,.35);
  border-radius:12px; overflow:hidden;
  box-shadow:0 8px 22px rgba(0,0,0,.5);
  background:#000;
}
#camFull video{
  width:100%; height:100%; object-fit:cover;
  transform: scaleX(-1); /* mirror ‡πÅ‡∏ö‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ñ‡∏≠‡∏• */
}

/* ‚úÖ ‡πÅ‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏™‡∏ï‡∏±‡∏î‡∏â‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏á: ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™, ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á 1 ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå */
#camCutout{
  position:absolute; inset:0;
  z-index:1;          /* ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ */
  pointer-events:none;
}

/* ‡∏Ñ‡∏≥ / ‡∏õ‡∏∏‡πà‡∏° / ‡πÄ‡∏î‡πá‡∏Å ‡πÉ‡∏´‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏™ */
.word{ z-index:2; }
#kid{ z-index:5; }
.hud{ z-index:9999; }
#overlay{ z-index:9999; }
#landing{ z-index:20000; }
#guideScreen{ z-index:20001; }

/* ====== HUD + ‡∏´‡∏•‡∏≠‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ====== */
.hud{
  position:fixed; inset:12px 12px auto 12px;
  display:flex; align-items:center; gap:12px; justify-content:space-between; pointer-events:none
}
.hud .left,.hud .right{ display:flex; align-items:center; gap:12px }
.pill{ background:var(--glass); backdrop-filter:blur(6px); padding:8px 12px; border-radius:999px; box-shadow:0 4px 18px rgba(0,0,0,.25) }
#timer{ font-weight:700; font-variant-numeric:tabular-nums; letter-spacing:.5px; font-size:20px }
.icon img{ width:44px; height:44px; object-fit:contain; filter:drop-shadow(0 4px 10px rgba(0,0,0,.6)); border-radius:8px }
.stack{ display:flex; flex-direction:column; gap:8px; align-items:flex-start }
.btn-mini{ pointer-events:auto; background:#1f2937; color:#fff; border:none; border-radius:12px; padding:8px 12px; font-weight:800; cursor:pointer; box-shadow:0 4px 18px rgba(0,0,0,.25) }
.btn-mini:hover{ filter:brightness(1.1) }

/* ‡∏´‡∏•‡∏≠‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô */
#scoreWrap{ pointer-events:auto; }
.gauge{
  position:relative; width:min(42vw, 380px); height:18px;
  background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18);
  border-radius:999px; overflow:hidden;
}
.gauge .fill{
  position:absolute; left:0; top:0; bottom:0; width:0%;
  background:#10b981;
  transition: width .18s ease, background-color .18s ease;
}
.gauge .label{
  position:absolute; inset:0; display:grid; place-items:center;
  font-size:12px; font-weight:900; color:#fff; text-shadow:0 1px 4px rgba(0,0,0,.6);
  pointer-events:none;
}
.gauge .fruit{
  position:absolute; right:8px; top:50%; transform:translateY(-50%);
  font-size:16px; pointer-events:none;
}

/* ====== ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°/‡∏à‡∏ö‡πÄ‡∏Å‡∏° ====== */
#startScreen{
  position:fixed; inset:0; display:none;
  flex-direction:column; align-items:center; justify-content:center;
  background:rgba(0,0,0,.9); z-index:9999; text-align:center; padding:24px;
}
#startTitle{ font-size:clamp(26px,5vw,48px); font-weight:900; margin-bottom:10px }
#startBtn{
  margin-top:12px; padding:10px 18px; border:0; border-radius:12px; font-weight:800; cursor:pointer; background:#1f2937; color:#fff
}
#startBtn:hover{ filter:brightness(1.1) }
#countdown{ display:none; font-size:clamp(56px,12vw,120px); font-weight:1000; line-height:1; margin-top:8px }

/* ====== ‡∏à‡∏ö‡πÄ‡∏Å‡∏° ====== */
#overlay{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.55); visibility:hidden; opacity:0; transition:.25s; z-index:9999 }
#overlay.show{ visibility:visible; opacity:1 }
.panel{ background:rgba(20,20,20,.9); border:1px solid rgba(255,255,255,.1); padding:22px 26px; border-radius:20px; min-width:320px; text-align:center; box-shadow:0 20px 60px rgba(0,0,0,.5) }
.panel h1{ margin:0 0 6px; font-size:28px }
.panel p{ margin:8px 0 18px; opacity:.85 }
.btn{ background:#1f2937; color:#fff; border:none; border-radius:12px; padding:10px 16px; font-weight:700; cursor:pointer }
.btn:hover{ filter:brightness(1.1) }
.wrong-box{ margin-top:14px; text-align:left }
.wrong-title{ font-weight:900; font-size:30px; margin-bottom:8px }
.wrong-list{ display:flex; flex-wrap:wrap; gap:8px; max-height:140px; font-size:28px; overflow:auto }
.chip{ background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:999px; font-weight:700 }
.muted{ opacity:.7 }

/* ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô overlay */
#overlay .btn {
  padding: 12px 24px;
  font-size: 20px;
  font-weight: 900;
  border-radius: 18px;
  min-width: 180px;
}

/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞ */
#restartBtn { background:#1f2937; color:#fff; }
#restartBtn:hover { filter:brightness(1.1); }
#selectLevelBtn { background:#2563eb; color:#fff; }
#selectLevelBtn:hover { background:#1d4ed8; }
#nextLevelBtn { background:#10b981; color:#fff; }
#nextLevelBtn:hover { background:#059669; }

/* ====== ‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡πâ‡∏≠‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ ====== */
#guideScreen{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:url("image/background3.png") center/cover no-repeat;
  z-index: 20001;
}
#guideScreen .guide-wrap{
  width:min(95vw, 1200px);
  max-height:92vh;
  display:flex; flex-direction:column; gap:10px;
  align-items:center; justify-content:center;
}
#guideScreen img{
  width:100%; height:auto; max-height:92vh;
  border-radius:14px;
  box-shadow:0 20px 60px rgba(0,0,0,.55);
  display:block;
}
#guideScreen .guide-close{
  align-self:flex-end;
  margin-top:8px;
  background:#1f2937; color:#fff;
  border:none; border-radius:12px; padding:8px 12px; font-weight:800; cursor:pointer;
}
#guideScreen .guide-close:hover{ filter:brightness(1.1) }

/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Overlay */
.actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px }

/* ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏≠‡∏¢ */
.float{
  position:fixed; left:0; top:90%; pointer-events:none;
  font-weight:800; font-size:24px; text-shadow:0 2px 8px rgba(0,0,0,.5)
}
@keyframes rise{ 0%{ transform:translate(-50%,-10px); opacity:0 } 15%{ opacity:1 } 100%{ transform:translate(-50%,-70px); opacity:0 } }

/* ******** ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏°: 3 ‡πÄ‡∏•‡∏ô + kid + ‡∏Ñ‡∏≥‡∏Å‡∏•‡∏° ******** */
#kid{
  position:absolute; bottom:22px; left:50%;
  width:200px; height:230px;
  transform:translateX(-50%);
  background:url("image/kid.png") center/contain no-repeat;
  z-index:5; pointer-events:none;
}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏±‡∏ö‡∏ö‡∏ô kid */
#acceptBox{
  position:absolute;
  left:50%; top:75%;
  transform:translateX(-50%);
  display:inline-block;
  background:#fff;
  border:2px solid #000;
  border-radius:14px; z-index:6;
  box-shadow:0 8px 24px rgba(0,0,0,.35);
  pointer-events:none;
}
#acceptBox .txt{
  font-weight:900; letter-spacing:.3px;
  font-size:36px;
  white-space:nowrap;
  color:#000;
  padding:4px 12px;
}

#catchLine{ display:none }

/* ‡∏ß‡∏á‡∏Ñ‡∏≥ */
.word{
  position:absolute; top:-160px; left:0;
  width:180px; height:180px; border-radius:50%;
  background:rgba(0,0,0,.48);
  border:2px solid rgba(255,255,255,.28);
  box-shadow:0 10px 22px rgba(0,0,0,.6);
  user-select:none; cursor:default; will-change:transform;
  overflow:visible;
  z-index:2; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á */
}
.word .inner{ position:relative; width:100%; height:100% }

/* ‡∏ú‡∏•‡πÑ‡∏°‡πâ ‚Äú‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏á‚Äù ‡πÄ‡∏™‡∏°‡∏≠ */
.word .fruit{
  position:absolute;
  left:50%; top:30%;
  transform:translate(-50%, -50%);
  font-size:66px;
  line-height:1;
  pointer-events:none;
}

/* ‡∏Ñ‡∏≥: ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏Å‡∏ô X ‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏°‡∏•‡πâ‡∏ô */
.word .label{
  position:absolute;
  left:50%; top:55%;
  transform:translateX(-50%);
  font-weight:900;
  text-align:center;
  text-shadow:0 2px 6px rgba(0,0,0,.8);
  font-size:36px;
  white-space:nowrap;
  overflow:visible;
  color:#fff;
}

/* ====== ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏° (‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ kid) ====== */
.accum{
  font-weight:900; color:#ffd700;
  text-shadow:0 1px 6px rgba(0,0,0,.35);
  font-size:22px; padding:6px 12px;
  background:rgba(0,0,0,.45); border-radius:12px;
}

@media (max-width:480px){
  .word{ width:112px; height:112px }
  .word .label{ font-size:18px }
  #kid{ width:180px; height:180px }
  #acceptBox{ top:10% }
}

/* Force hide PIP forever */
#camFull{ display:none !important; visibility:hidden !important; }
</style>
</head>
<body>
  <div id="game" aria-label="‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏Å‡∏°">
    <!-- ‚úÖ ‡∏Å‡∏•‡πâ‡∏≠‡∏á PIP ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á -->
    <div id="camFull" aria-hidden="true">
      <video id="camFullVid" autoplay playsinline muted></video>
    </div>

    <!-- ‚úÖ ‡πÅ‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏™‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏•‡∏≠‡∏¢‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏â‡∏≤‡∏Å) -->
    <canvas id="camCutout"></canvas>

    <div id="kid" aria-hidden="false">
      <div id="acceptBox" role="note" aria-label="‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥">
        <div class="txt" id="ruleLabel">‡∏™‡∏£‡∏∞ ‡πÄ-‡∏≤</div>
      </div>
    </div>
  </div>

  <!-- Landing = ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô -->
  <div id="landing" role="dialog" aria-modal="true">
    <div class="brand"><img src="image/banner3.png" alt="Banner"></div>

    <div class="level-menu">
      <button class="levelBtn" data-level="0">‡∏™‡∏£‡∏∞ ‡πÄ-‡∏≤</button>
      <button class="levelBtn" id="guideBtn">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô üìã</button>
    </div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° -->
  <div id="startScreen">
    <div id="startTitle">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏Ç‡∏¢‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
    <div id="countdown">3</div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡πâ‡∏≠‡∏ô: ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ -->
  <div id="guideScreen" style="display:none;">
    <div class="guide-wrap">
      <img src="image/guide.png" alt="‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡πÄ‡∏Å‡∏°">
      <button id="guideBack" class="btn-mini guide-close">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
  </div>

  <!-- HUD + ‡πÄ‡∏Å‡∏à‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -->
  <div class="hud">
    <div class="left">
      <div class="stack">
        <div class="pill" id="timer">02:00</div>
        <div style="display:flex; gap:8px;">
          <button id="pauseBtn" class="btn-mini">‚è∏ ‡∏´‡∏¢‡∏∏‡∏î</button>
          <button id="quickRestart" class="btn-mini">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
      </div>
    </div>

    <div class="right">
      <div id="scoreWrap" class="pill" style="padding:10px 12px;">
        <div class="gauge" aria-label="‡∏´‡∏•‡∏≠‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô">
          <div class="fill" id="scoreFill"></div>
          <div class="label"><span id="scoreText">0</span>%</div>
          <div class="fruit" id="scoreFruit">üçé</div>
        </div>
      </div>
      <div class="stack" style="align-items:flex-end">
        <div id="accumWrap" class="accum">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°: <b id="accumVal">0</b></div>
      </div>
    </div>
  </div>

  <!-- ‡∏à‡∏ö‡πÄ‡∏Å‡∏° -->
  <div id="overlay">
    <div class="panel">
      <h1 id="endTitle">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h1>
      <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: <b id="finalScore">0</b>%</p>
      <p id="accumSummary" style="display:none; color:#ffd700; font-weight:900;">
        ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏£‡∏ß‡∏° (4 ‡∏£‡∏≠‡∏ö): <b id="accumTotal">0</b>
      </p>
      <div class="wrong-box" style="display:none;">
        <div class="wrong-title">‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏°‡∏≤‡∏ú‡∏¥‡∏î</div>
        <div id="wrongList" class="wrong-list"></div>
      </div>
      <div class="actions">
        <button class="btn" id="restartBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn" id="selectLevelBtn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô</button>
        <button class="btn" id="nextLevelBtn">‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
      </div>
    </div>
  </div>

  <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
  <audio id="hitSound" preload="auto"></audio>
  <audio id="winSound" preload="auto"></audio>
  <audio id="bgm" preload="auto"></audio>

<!-- ‡∏õ‡∏∏‡πà‡∏° Full Screen -->
<button id="fsBtn" title="Full Screen"
  style="position:fixed; right:12px; bottom:64px; width:44px; height:44px;
         border-radius:999px; background:rgba(0,0,0,.45);
         border:1px solid rgba(255,255,255,.3); color:#fff; font-size:18px;
         line-height:1; display:grid; place-items:center; cursor:pointer;
         z-index:10000;">‚õ∂</button>


  <!-- ‡∏õ‡∏∏‡πà‡∏° Mute -->
  <button id="muteBtn" aria-pressed="false" title="Mute / Unmute"
    style="position:fixed; right:12px; bottom:12px; width:44px; height:44px; border-radius:999px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.3); color:#fff; font-size:18px; line-height:1; display:grid; place-items:center; cursor:pointer; z-index:10000;">üîä</button>

  <!-- MediaPipe deps (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>

  <!-- ====== ‡∏õ‡∏∏‡πà‡∏° Mute handler ====== -->
  <script>
  (function(){
    const muteBtn = document.getElementById('muteBtn');
    const audios = [
      document.getElementById('bgm'),
      document.getElementById('hitSound'),
      document.getElementById('winSound')
    ].filter(Boolean);
    function setIcon(){
      const muted = audios.length && audios.every(a => a.muted);
      muteBtn.textContent = muted ? 'üîá' : 'üîä';
      muteBtn.setAttribute('aria-pressed', muted ? 'true' : 'false');
    }
    muteBtn.addEventListener('click', ()=>{
      const next = !(audios[0]?.muted);
      audios.forEach(a => a.muted = next);
      setIcon();
    });
    setIcon();
  })();
  </script>

<script>
(function(){
  const fsBtn = document.getElementById('fsBtn');
  if(!fsBtn) return;

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Safari)
  const isFS = () => document.fullscreenElement || document.webkitFullscreenElement;

  function updateIcon(){
    // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠: ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏¢‡πà‡∏≠ (üóó) | ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠: ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢ (‚õ∂)
    fsBtn.textContent = isFS() ? 'üóó' : '‚õ∂';
    fsBtn.setAttribute('aria-pressed', isFS() ? 'true' : 'false');
  }

  async function enterFS(){
    const el = document.documentElement; // ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤
    try{
      if (el.requestFullscreen) await el.requestFullscreen();
      else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen(); // Safari
    }catch(e){
      alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠: ' + (e?.message || e));
    }
  }

  async function exitFS(){
    try{
      if (document.exitFullscreen) await document.exitFullscreen();
      else if (document.webkitExitFullscreen) await document.webkitExitFullscreen(); // Safari
    }catch(e){
      // ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ ‡∏Å‡πá‡πÑ‡∏î‡πâ
    }
  }

  fsBtn.addEventListener('click', async ()=>{
    // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ "‡∏Ñ‡∏•‡∏¥‡∏Å" ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏¢‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏π‡∏•‡∏™‡∏Å‡∏£‡∏µ‡∏ô
    if (!isFS()) await enterFS();
    else await exitFS();
  });

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ü‡∏π‡∏•‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏î ESC)
  document.addEventListener('fullscreenchange', updateIcon);
  document.addEventListener('webkitfullscreenchange', updateIcon);

  updateIcon();
})();
</script>


  <!-- ====== ‡∏Å‡∏•‡πâ‡∏≠‡∏á + Segmentation + ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ====== -->
  <script>
  (function(){
    // ===== ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á =====
    const motionBtn = document.createElement('button');
    Object.assign(motionBtn, { id:'motionBtn', innerText:'üì∑: Off', title:'‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏®‡∏µ‡∏£‡∏©‡∏∞' });
    Object.assign(motionBtn.style, {
      position:'fixed', right:'64px', bottom:'12px', width:'44px', height:'44px',
      borderRadius:'999px', background:'rgba(0,0,0,.45)', border:'1px solid rgba(255,255,255,.3)',
      color:'#fff', fontSize:'18px', display:'grid', placeItems:'center', cursor:'pointer', zIndex:10000
    });
    document.body.appendChild(motionBtn);

const SHOW_PIP = false;  // ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏•‡∏≠‡∏î ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á/‡∏ï‡∏±‡∏î‡∏â‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏á


    // ===== ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏ô DOM ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì =====
    const camFull    = document.getElementById('camFull');
    const camFullVid = document.getElementById('camFullVid');
    const cutCvs     = document.getElementById('camCutout');
    const cutCtx     = cutCvs.getContext('2d', { willReadFrequently:true });

    // ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ)
    const video = document.createElement('video');
    Object.assign(video, { autoplay:true, playsInline:true, muted:true });
    video.style.display = 'none';
    document.body.appendChild(video);

    // ===== ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ =====
    let stream = null, enabled = false, rafId = 0, heartbeatId = 0, watchdogId = 0, camLoop = null;
    const MIRROR = true;

    // ===== ‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡πâ‡∏ß‡∏¢ MediaPipe Selfie Segmentation =====
    const selfieSegmentation = new SelfieSegmentation({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`
    });
    selfieSegmentation.setOptions({ modelSelection: 1 });

    function onResults(results){
  const w = cutCvs.width  = cutCvs.clientWidth  || window.innerWidth;
  const h = cutCvs.height = cutCvs.clientHeight || window.innerHeight;

  cutCtx.save();
  cutCtx.clearRect(0,0,w,h);

  // üîÅ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡∏ô X ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≤‡∏î mask ‡πÅ‡∏•‡∏∞ image
  if (MIRROR){
    cutCtx.translate(w, 0);
    cutCtx.scale(-1, 1);
  }

  // 1) ‡∏ß‡∏≤‡∏î mask (‡∏Ç‡∏≤‡∏ß=‡∏Ñ‡∏ô, ‡∏î‡∏≥=‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) ‚Äî ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
  cutCtx.drawImage(results.segmentationMask, 0, 0, w, h);

  // 2) ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ô
  cutCtx.globalCompositeOperation = 'source-in';

  // 3) ‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡πá‡∏Å‡∏ã‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡πâ‡∏≤ MIRROR=true)
  cutCtx.drawImage(results.image, 0, 0, w, h);

  cutCtx.globalCompositeOperation = 'source-over';
  cutCtx.restore();
}

    selfieSegmentation.onResults(onResults);

    // ===== ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏®‡∏µ‡∏£‡∏©‡∏∞ (FaceDetector + Motion fallback) =====
    const hasFace   = 'FaceDetector' in window;
    const detector  = hasFace ? new FaceDetector({ fastMode:true, maxDetectedFaces:1 }) : null;

    // ‡πÄ‡∏ü‡∏£‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö motion
    const W=128, H=96;
    const cvs=document.createElement('canvas'); cvs.width=W; cvs.height=H;
    const ctx=cvs.getContext('2d',{willReadFrequently:true});
    let prev=null, prevCxNorm=null, prevTs=null;

    const ROI_Y_MIN = 0.20, ROI_Y_MAX = 0.85;
    const LUMA_MIN  = 30;
    const SMOOTH_ALPHA = 0.35;
    const PERSIST_FR = 3;
    const LEFT_ENTER=0.40, RIGHT_ENTER=0.60;
    const LEFT_COMMIT=0.35, RIGHT_COMMIT=0.65;
    const MIN_BLOB_AREA = 0.003;
    const SPEED_THRESH  = 0.004;

    let currentLane=1, pendingLane=null, persistCount=0, smoothX=0.5;
    let targetLane=1, lastLockTs=0;

    function sendLane(l){
      if (window.__GAME__?.__isRunning?.()){
        window.__GAME__.moveLane?.(l);
      }
    }
    function commitLane(cxNorm){
      let target=currentLane;
      if (cxNorm < LEFT_ENTER) target=0;
      else if (cxNorm > RIGHT_ENTER) target=2;
      else if (cxNorm > 0.45 && cxNorm < 0.55) target=1;

      if (target!==currentLane){
        if (pendingLane!==target){ pendingLane=target; persistCount=1; }
        else persistCount++;
        const ok =
          (pendingLane===0 && cxNorm<=LEFT_COMMIT) ||
          (pendingLane===2 && cxNorm>=RIGHT_COMMIT) ||
          (pendingLane===1 && cxNorm>0.45 && cxNorm<0.55);
        if (ok && persistCount>=PERSIST_FR){
          currentLane=pendingLane; pendingLane=null; persistCount=0;
          targetLane=currentLane;
          sendLane(currentLane);
        }
      } else { pendingLane=null; persistCount=0; targetLane=currentLane; }
    }

    function avgLuma(imgData){
      const d=imgData.data; let s=0, n=0;
      for(let i=0;i<d.length;i+=4){ s += (0.2126*d[i] + 0.7152*d[i+1] + 0.0722*d[i+2]); n++; }
      return s/n;
    }

    function motionHeadCenter(){
      if (MIRROR){ ctx.save(); ctx.scale(-1,1); ctx.drawImage(video,-W,0,W,H); ctx.restore(); }
      else { ctx.drawImage(video,0,0,W,H); }
      const img=ctx.getImageData(0,0,W,H), d=img.data;
      const y0=Math.floor(H*ROI_Y_MIN), y1=Math.floor(H*ROI_Y_MAX);
      let sum=0,sumX=0,pix=0;
      if(prev && prev.length===d.length){
        for(let y=y0;y<y1;y++){
          for(let x=0;x<W;x++){
            const i=(y*W+x)*4;
            const diff = (Math.abs(d[i]-prev[i])+Math.abs(d[i+1]-prev[i+1])+Math.abs(d[i+2]-prev[i+2]))/3;
            if (diff>18){ sum+=diff; sumX+=diff*x; pix++; }
          }
        }
      }
      prev = new Uint8ClampedArray(d);

      const roiPixels = W*(y1-y0);
      const area = pix/roiPixels;
      if (area < MIN_BLOB_AREA) return null;

      const cx = sum ? (sumX/sum) : null;
      if (cx==null) return null;
      const now = performance.now();
      const cxNorm = cx/W;

      let okSpeed = true;
      if (prevCxNorm!=null && prevTs!=null){
        const dt = Math.max(1, now-prevTs);
        const v = Math.abs(cxNorm - prevCxNorm) / dt; // per ms
        okSpeed = v >= SPEED_THRESH/1000;
      }
      prevCxNorm=cxNorm; prevTs=now;

      if (!okSpeed) return null;
      return cxNorm;
    }

    async function loop(){
      if(!enabled||!stream) return;
      try{
        let usedFace = false;

        // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏™‡∏á
        ctx.drawImage(video,0,0,W,H);
        const luma = avgLuma(ctx.getImageData(0,0,W,H));
        const enoughLight = luma >= LUMA_MIN;

        if (hasFace && enoughLight){
          const faces = await detector.detect(video);
          if (faces && faces.length){
            const f = faces[0].boundingBox;
            let cx = f.x + f.width/2;
            const vw=video.videoWidth||640;
            let cxNorm=cx/vw; if(MIRROR) cxNorm = 1 - cxNorm;
            smoothX = smoothX + SMOOTH_ALPHA*(cxNorm - smoothX);
            commitLane(smoothX);
            lastLockTs = performance.now();
            usedFace = true;
          }
        }
        if (!usedFace){
          const cxNorm = motionHeadCenter();
          if (cxNorm!=null){
            smoothX = smoothX + SMOOTH_ALPHA*(cxNorm - smoothX);
            commitLane(smoothX);
            lastLockTs = performance.now();
          }
        }
      }catch(e){}
      rafId = requestAnimationFrame(loop);
    }

    async function heartbeat(){
      if(!enabled||!stream) return;
      const now = performance.now();
      if (now - lastLockTs <= 450){ sendLane(currentLane); return; }

      try{
        if (hasFace){
          const faces = await detector.detect(video);
          if (faces && faces.length){
            const f=faces[0].boundingBox;
            let cx=f.x+f.width/2, vw=video.videoWidth||640;
            let cxNorm=cx/vw; if(MIRROR) cxNorm=1-cxNorm;
            smoothX = smoothX + 0.6*(cxNorm - smoothX);
            commitLane(smoothX);
            lastLockTs = now; return;
          }
        }
        const cxNorm = motionHeadCenter();
        if (cxNorm!=null){
          smoothX = smoothX + 0.6*(cxNorm - smoothX);
          commitLane(smoothX);
          lastLockTs = now; return;
        }
      }catch(e){}
      sendLane(currentLane);
    }

    function watchdog(){
      if(!enabled||!stream) return;
      const gameLane = window.__GAME__?.getLane?.();
      if (typeof gameLane==='number' && gameLane!==targetLane){
        sendLane(targetLane);
      }
    }

    // ===== ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏õ‡∏¥‡∏î =====
    async function enable(){
      if(enabled) return;
      try{
        stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'user' }, audio:false });
        video.srcObject = stream;
        await video.play().catch(()=>{});

        // ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß PIP ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á (‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡πâ‡∏≤ SHOW_PIP=false)
if (SHOW_PIP && camFullVid && camFull){
  camFullVid.srcObject = stream;
  await camFullVid.play().catch(()=>{});
  camFull.style.display = 'block';
}

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏™‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
        cutCvs.style.display = 'block';
        cutCvs.width = window.innerWidth; 
        cutCvs.height = window.innerHeight;

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡πÄ‡∏ü‡∏£‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ MediaPipe
        camLoop = new Camera(video, {
          onFrame: async () => { await selfieSegmentation.send({ image: video }); },
          width: 1280, height: 720
        });
        camLoop.start();

        enabled = true;
        motionBtn.innerText = 'üì∑: On';

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ tracking ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏° loop ‡∏ï‡πà‡∏≤‡∏á ‡πÜ
        prev=null; prevCxNorm=null; prevTs=null; pendingLane=null; persistCount=0; targetLane=currentLane; lastLockTs=0;
        cancelAnimationFrame(rafId); rafId=requestAnimationFrame(loop);
        clearInterval(heartbeatId); heartbeatId=setInterval(heartbeat, 500);
        clearInterval(watchdogId);  watchdogId=setInterval(watchdog, 300);
      }catch(err){
        alert('‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: '+(err?.name||'')+' '+(err?.message||err));
      }
    }

    function disable(){
      enabled=false; motionBtn.innerText='üì∑: Off';
      cancelAnimationFrame(rafId);
      clearInterval(heartbeatId); clearInterval(watchdogId);

      try{ camLoop && camLoop.stop(); }catch(e){}
      if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }

      video.srcObject=null;

      if (SHOW_PIP && camFullVid){ camFullVid.pause?.(); camFullVid.srcObject=null; }
if (SHOW_PIP && camFull){ camFull.style.display='none'; }

      cutCtx.clearRect(0,0,cutCvs.width,cutCvs.height);
      cutCvs.style.display='none';
    }

    motionBtn.addEventListener('click', ()=>{ enabled?disable():enable(); });
    window.addEventListener('beforeunload', disable);

    // ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏Å‡∏±‡∏ô error ‡∏ñ‡πâ‡∏≤ __GAME__ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡πá‡∏ï)
    if(!window.__GAME__) window.__GAME__ = {};
    if(!window.__GAME__.__isRunning) window.__GAME__.__isRunning = ()=>true;

// ===== Watchdog: ‡πÄ‡∏ù‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡∏ñ‡πâ‡∏≤ stream ‡∏î‡∏±‡∏ö ‡πÉ‡∏´‡πâ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ =====
function isStreamAlive(){
  return !!(stream && stream.getVideoTracks().some(t => t.readyState === 'live'));
}

// ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà
window.addEventListener('visibilitychange', ()=>{
  if (document.visibilityState === 'visible' && enabled && !isStreamAlive()){
    try{ disable(); }catch(e){}
    enable();
  }
});

// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥ ‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á live ‡πÑ‡∏´‡∏°
setInterval(()=>{
  if (enabled && !isStreamAlive()){
    try{ disable(); }catch(e){}
    enable();
  }
}, 2000);

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏Å‡∏° ‚Äú‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå‚Äù ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
window.__CAM__ = { ensureOn: ()=>{ /* no-op */ return false; } };

  })();
  </script>

  <!-- ====== ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏° (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ====== -->
  <script>
  (() => {
    const game = document.getElementById('game');
    const timerEl = document.getElementById('timer');
    const overlay = document.getElementById('overlay');
    const endTitleEl = document.getElementById('endTitle');
    const finalScoreEl = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');
    const quickRestart = document.getElementById('quickRestart');
    const selectLevelBtn = document.getElementById('selectLevelBtn');
    const nextLevelBtn = document.getElementById('nextLevelBtn');

    const hitSound = document.getElementById('hitSound');
    const theWin = document.getElementById('winSound');
    const bgm = document.getElementById('bgm');

    if (hitSound) { hitSound.src = "image/fruit.mp3"; hitSound.volume = 1.0; }
    if (theWin)   { theWin.src  = "image/win2.mp3";  theWin.volume  = 1.0; }
    if (bgm)      { bgm.volume  = 0.35; }

    const BGM_TRACKS = ["image/bgm4.mp3","image/bgm5.mp3","image/bgm6.mp3"];
    let bgmIndex = 0;
    function playBgm(){
      if (!bgm || !BGM_TRACKS.length) return;
      bgm.src = BGM_TRACKS[bgmIndex];
      bgm.currentTime = 0;
      bgm.play().catch(()=>{});
      bgm.onended = () => { bgmIndex = (bgmIndex + 1) % BGM_TRACKS.length; playBgm(); };
    }

    const startScreen  = document.getElementById('startScreen');
    const startTitle   = document.getElementById('startTitle');
    const startBtn     = document.getElementById('startBtn');
    const countdownEl  = document.getElementById('countdown');

    function openStartForLevel(autoCountdown = true){
      const L = LEVELS[selectedLevel];
      if(startTitle){
        startTitle.textContent = (L && L.mission) ? L.mission : `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${L?.name || ''}`;
      }
      if(startScreen) startScreen.style.display = 'flex';
      if(startBtn) startBtn.style.display = 'none';
      if(!autoCountdown) return;
      if(countdownEl){
        let n = 3;
        countdownEl.textContent = n;
        countdownEl.style.display = 'block';
        const itv = setInterval(() => {
          n--;
          if(n > 0){ countdownEl.textContent = n; }
          else{
            clearInterval(itv);
            if(startScreen) startScreen.style.display = 'none';
            startGame();
          }
        }, 1000);
      }
    }

    const wrongListEl = document.getElementById('wrongList');
    const wrongBoxEl  = document.querySelector('.wrong-box');

    const kid = document.getElementById('kid');
    const ruleLabelEl = document.getElementById('ruleLabel');

    const scoreFill = document.getElementById('scoreFill');
    const scoreText = document.getElementById('scoreText');
    const scoreFruit = document.getElementById('scoreFruit');
    const fruits = ["üçé","üçå","üçá","üçâ","üçç","üçì","üçë","üçí","ü•≠","ü´ê","ü•ù","üçê","üçä"];

 // ====== ‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏î‡πà‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î) ======
const BASE1_CORRECT = [
"‡πÄ‡∏´‡∏≤","‡πÄ‡∏´‡πà‡∏≤","‡πÄ‡∏°‡∏≤","‡πÄ‡∏•‡πà‡∏≤","‡πÄ‡∏´‡∏•‡πâ‡∏≤","‡πÄ‡∏Å‡πà‡∏≤","‡πÄ‡∏Å‡πâ‡∏≤","‡πÄ‡∏õ‡πâ‡∏≤","‡πÄ‡∏õ‡πà‡∏≤‡∏õ‡∏µ‡πà","‡πÄ‡∏ú‡∏≤","‡πÄ‡∏™‡∏≤‡πÑ‡∏ü","‡πÄ‡∏ï‡∏≤‡πÑ‡∏ü","‡πÄ‡∏™‡∏≤‡∏£‡πå","‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤","‡∏™‡∏µ‡πÄ‡∏ó‡∏≤","‡πÄ‡∏ó‡πâ‡∏≤","‡πÄ‡∏Ç‡πà‡∏≤","‡πÄ‡∏á‡∏≤","‡πÄ‡∏´‡∏á‡πâ‡∏≤","‡πÄ‡∏®‡∏£‡πâ‡∏≤","‡πÄ‡∏à‡πâ‡∏≤‡∏ó‡∏µ‡πà","‡∏á‡∏π‡πÄ‡∏´‡πà‡∏≤","‡πÄ‡∏ô‡πà‡∏≤",
"‡∏†‡∏π‡πÄ‡∏Ç‡∏≤","‡πÄ‡∏ä‡πâ‡∏≤","‡πÄ‡∏ä‡πà‡∏≤","‡∏Å‡∏≥‡πÄ‡∏î‡∏≤","‡πÄ‡∏ï‡πà‡∏≤","‡∏ú‡∏π‡πâ‡πÄ‡∏í‡πà‡∏≤","‡πÄ‡∏ö‡∏≤","‡πÄ‡∏ù‡πâ‡∏≤‡πÑ‡∏Ç‡πâ","‡∏™‡∏≥‡πÄ‡∏†‡∏≤","‡πÄ‡∏´‡∏°‡∏≤","‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤","‡∏Å‡∏£‡∏∞‡πÄ‡∏ä‡πâ‡∏≤","‡πÄ‡∏¢‡∏≤‡∏ß‡πå","‡πÄ‡∏£‡∏≤","‡πÄ‡∏•‡πâ‡∏≤‡πÑ‡∏Å‡πà","‡πÄ‡∏´‡∏•‡πà‡∏≤","‡πÄ‡∏≠‡∏≤‡πÉ‡∏à","‡∏™‡∏∞‡πÄ‡∏õ‡∏≤","‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à","‡πÄ‡∏Å‡∏≤‡∏Ç‡∏≤","‡πÄ‡∏•‡πâ‡∏≤‡∏´‡∏°‡∏π",
"‡πÄ‡∏â‡∏≤","‡πÄ‡∏à‡πâ‡∏≤","‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤","‡∏õ‡∏•‡∏≤‡πÄ‡∏Å‡πã‡∏≤","‡∏ã‡∏≤‡∏•‡∏≤‡πÄ‡∏õ‡∏≤","‡πÄ‡∏ö‡πâ‡∏≤","‡πÄ‡∏Ç‡∏≤‡∏ß‡∏±‡∏á","‡πÄ‡∏Å‡∏•‡πâ‡∏≤","‡πÄ‡∏Ç‡∏•‡∏≤","‡πÄ‡∏Ñ‡∏£‡∏≤","‡πÄ‡∏Ñ‡∏•‡πâ‡∏≤","‡πÄ‡∏õ‡∏•‡πà‡∏≤","‡πÄ‡∏û‡∏•‡∏≤","‡∏ó‡∏∏‡πÄ‡∏£‡∏≤","‡∏°‡∏±‡∏ß‡πÄ‡∏°‡∏≤"
];

const BASE1_WRONG = [
  "‡πÑ‡∏Å‡πà","‡∏Å‡∏≤","‡∏ï‡∏≤","‡∏ô‡∏≤","‡∏¢‡∏≤","‡∏ú‡∏µ","‡∏ä‡∏µ‡πâ","‡∏¢‡πà‡∏≤","‡∏™‡∏µ","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏°‡πâ‡∏≤","‡∏•‡∏≤","‡∏•‡πà‡∏≤","‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà","‡πÅ‡∏û","‡πÅ‡∏û‡∏∞","‡πÅ‡∏Å‡∏∞","‡∏á‡∏π","‡∏õ‡∏π‡∏ô‡∏≤","‡∏õ‡∏•‡∏≤‡∏ó‡∏π","‡∏ó‡∏∞‡πÄ‡∏•","‡∏ß‡∏¥‡∏ä‡∏≤","‡πÇ‡∏ö","‡πÇ‡∏°‡πÇ‡∏´","‡∏≠‡∏µ‡∏Å‡∏≤","‡∏ó‡∏≤‡∏™‡∏µ",
  "‡πÑ‡∏ü‡∏ü‡πâ‡∏≤","‡∏Å‡∏∞‡∏ó‡∏¥","‡∏Å‡∏∞‡∏õ‡∏¥","‡∏°‡∏∞‡∏£‡∏∞","‡∏ä‡∏∞‡∏ô‡∏µ","‡∏®‡∏≤‡∏•‡∏≤","‡∏á‡∏≤","‡πÄ‡∏™‡∏∑‡∏≠","‡πÄ‡∏™‡∏∑‡πâ‡∏≠","‡πÄ‡∏Å‡πÄ‡∏£","‡∏ï‡∏≤‡πÄ‡∏Ç","‡πÄ‡∏ß‡∏ó‡∏µ","‡πÇ‡∏•‡∏°‡∏≤","‡∏ö‡∏±‡∏ß","‡πÅ‡∏°‡πà‡∏ß‡∏±‡∏ß","‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠","‡πÉ‡∏à‡∏î‡∏µ","‡πÉ‡∏ö‡πÑ‡∏°‡πâ","‡∏™‡∏≥‡∏•‡∏µ","‡∏ï‡∏≥","‡∏´‡∏ç‡πâ‡∏≤","‡∏´‡∏ß‡∏µ","‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠","‡∏ú‡∏∏",
  "‡πÄ‡∏ï‡∏∞","‡πÄ‡∏á‡∏≤‡∏∞","‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏∞","‡∏Å‡∏≠‡πÑ‡∏ú‡πà","‡∏ó‡πâ‡∏≠‡πÅ‡∏ó‡πâ","‡∏•‡∏≥‡πÑ‡∏™‡πâ","‡∏ñ‡∏±‡πà‡∏ß","‡∏Ñ‡∏∞‡∏ô‡πâ‡∏≤","‡∏õ‡∏•‡∏≤‡∏£‡πâ‡∏≤","‡∏•‡∏¥‡πÄ‡∏Å"
];


    const LEVELS = [
      { id:0, name:"‡∏™‡∏£‡∏∞ ‡πÄ-‡∏≤", ruleText:"‡∏™‡∏£‡∏∞ ‡πÄ-‡∏≤", mission:"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à : ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏° ‡∏™‡∏£‡∏∞ ‡πÄ-‡∏≤ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", correctWords:BASE1_CORRECT, wrongWords:BASE1_WRONG },
    ];
    let selectedLevel = 0;

    // ====== ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡πâ‡∏≤‡∏°‡∏î‡πà‡∏≤‡∏ô ======
    let cumulativeScore = 0;
    let roundsPlayed   = 0;
    let lastRunScore   = 0;

    function updateAccum(){
      const el = document.getElementById('accumVal');
      if(el) el.textContent = cumulativeScore.toString();
    }

    function refreshNextButton(){
      const sumEl = document.getElementById('accumSummary');
      const totalEl = document.getElementById('accumTotal');
      if (roundsPlayed < 3){
        nextLevelBtn.disabled = false;
        nextLevelBtn.textContent = '‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
        nextLevelBtn.style.opacity = '1';
        if(sumEl) sumEl.style.display = 'none';
        return;
      }
      if (roundsPlayed === 3){
        nextLevelBtn.disabled = false;
        nextLevelBtn.textContent = '‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°';
        nextLevelBtn.style.opacity = '1';
        if(sumEl) sumEl.style.display = 'none';
        return;
      }
      nextLevelBtn.disabled = true;
      nextLevelBtn.textContent = '‡∏Ñ‡∏£‡∏ö 4 ‡∏£‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß';
      nextLevelBtn.style.opacity = '0.6';
      if (sumEl && totalEl){
        totalEl.textContent = cumulativeScore.toString();
        sumEl.style.display = 'block';
      }
    }

    let running = false;
    let spawner = null;
    let countdown = null;
    let ended = false;

    const stageSeconds = 120;
    const LANES = [0.20, 0.50, 0.80];
    const WORD_SIZE = 140;

    const MIN_GAP = 160;
    const SAFE_NEAR_TOP = 280;
    const MAX_NEAR_TOP_LANES = 2;
    const SPAWN_INTERVAL = 700;

    let gauge = 0;

    function laneX(i){ return Math.round(window.innerWidth * LANES[i]); }
    function placeKid(){
      const x = laneX(kidLane);
      kid.style.left = x + 'px';
      kid.style.transform = 'translateX(-50%)';
    }
    function fmt(sec){
      const m = Math.floor(sec/60).toString().padStart(2,'0');
      const s = (sec%60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }
    function setGauge(v){
      gauge = Math.max(0, Math.min(100, v));
      scoreFill.style.width = gauge + '%';
      scoreText.textContent = gauge;
      if(gauge >= 66) scoreFill.style.backgroundColor = '#10b981';
      else if(gauge >= 33) scoreFill.style.backgroundColor = '#f59e0b';
      else scoreFill.style.backgroundColor = '#f97316';
      if(Math.random() < 0.25){
        scoreFruit.textContent = fruits[Math.floor(Math.random()*fruits.length)];
      }
      if (running && !ended && gauge >= 100){
        endGame('win');
      }
    }
    function floatText(text, x, y, kind){
      const t = document.createElement('div');
      t.className = 'float';
      t.textContent = text;
      t.style.left = x+'px';
      t.style.top = y+'px';
      t.style.color = (kind==='ok') ? 'var(--ok)' : 'var(--bad)';
      t.style.animation = 'rise 800ms ease-out forwards';
      document.body.appendChild(t);
      t.addEventListener('animationend', () => t.remove(), {once:true});
    }
    function playHit(){
      try {
        const a = hitSound.cloneNode(true);
        a.volume = 1;
        a.src = hitSound.src;
        a.play().catch(()=>{});
      } catch(e){}
    }

    function canSpawnInLane(lane){
      const words = [...document.querySelectorAll('.word')].filter(w => Number(w.dataset.lane) === lane);
      for(const w of words){
        const y = parseFloat(w.dataset.y)||-160;
        if(y < 160) return false;
      }
      return true;
    }
    function hasRoomForAnotherLane(){
      const lanesUsed = new Set();
      document.querySelectorAll('.word').forEach(w=>{
        const y = parseFloat(w.dataset.y)||-160;
        if(y < 280) lanesUsed.add(Number(w.dataset.lane));
      });
      return lanesUsed.size < 2;
    }

    /* ====== ‡∏™‡∏≥‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥ ====== */
    let wordPool = [];
    let poolIndex = 0;
    function refillPool(){
      const L = LEVELS[selectedLevel];
      wordPool = [];
      L.correctWords.forEach(w => wordPool.push({text:w, value:1}));
      L.wrongWords.forEach(w => wordPool.push({text:w, value:0}));
      for(let i = wordPool.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [wordPool[i], wordPool[j]] = [wordPool[j], wordPool[i]];
      }
      poolIndex = 0;
    }
    function makeWord(){
      if(poolIndex >= wordPool.length){ refillPool(); }
      const data = wordPool[poolIndex++];

      const node = document.createElement('div');
      node.className = 'word';

      const inner = document.createElement('div');
      inner.className = 'inner';
      const fruit = document.createElement('div');
      fruit.className = 'fruit';
      fruit.textContent = fruits[Math.floor(Math.random()*fruits.length)];
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = data.text;

      node.dataset.value = data.value.toString();

      inner.appendChild(fruit);
      inner.appendChild(label);
      node.appendChild(inner);
      return node;
    }
    function spawnWord(){
      if(!running) return;
      if(!hasRoomForAnotherLane()) return;

      const order = [0,1,2].sort(()=>Math.random()-0.5);
      let chosen = null;
      for(const lane of order){
        if(canSpawnInLane(lane)){ chosen = lane; break; }
      }
      if(chosen === null) return;

      const node = makeWord();
      node.dataset.lane = chosen;
      node.dataset.y = -160;

      const x = laneX(chosen) - 140/2;
      node.style.left = x + 'px';
      node.style.top = (-160) + 'px';
      game.appendChild(node);
    }

    const GAIN_CORRECT = 10;
    const LOSS_WRONG   = 15;

    let kidLane = 1;
    let remain = stageSeconds;
    function currentSpeed(){ return (remain <= 40) ? 200 : 135; }
    let lastTime = 0;

    function tick(now){
      const dt = Math.min(0.05, (now - lastTime)/1000);
      lastTime = now;

      const speed = currentSpeed();

      const acceptBox = document.getElementById('acceptBox');
      const hb = acceptBox.getBoundingClientRect();
      const hitW = Math.max(1, hb.width  * 0.60);
      const hitH = Math.max(1, hb.height * 0.30);
      const hitCx = hb.left + hb.width / 2;
      const hitCy = hb.bottom - hitH / 2 + 16;

      const hitLeft   = hitCx - hitW/2;
      const hitRight  = hitCx + hitW/2;
      const hitTop    = hitCy - hitH/2;
      const hitBottom = hitCy + hitH/2;

      document.querySelectorAll('.word').forEach(node => {
        let y = parseFloat(node.dataset.y)||-160;
        y += speed * dt;
        node.dataset.y = y;
        node.style.transform = `translateY(${y}px)`;

        const nodeLeft = parseFloat(node.style.left)||0;
        const wordCenterX = nodeLeft + 140/2;
        const wordCenterY = y + 140/2;
        const wordBottomY = y + 140;

        const overlapY = (wordBottomY >= hitTop) && (wordCenterY <= hitBottom);
        const overlapX = (wordCenterX >= (hitLeft - 100)) && (wordCenterX <= (hitRight + 100));

        if (overlapX && overlapY){
          const isCorrect = node.dataset.value === '1';
          if(isCorrect){
            setGauge(gauge + GAIN_CORRECT);
            floatText('+'+GAIN_CORRECT, hitCx, hitBottom, 'ok');
          }else{
            setGauge(gauge - LOSS_WRONG);
            const text = node.querySelector('.label')?.textContent?.trim();
            if(text) clickedWrongWords.push(text);
            floatText('-'+LOSS_WRONG, hitCx, hitBottom, 'bad');
          }
          try{ const a = hitSound.cloneNode(true); a.volume = 1; a.src = hitSound.src; a.play().catch(()=>{}); }catch(e){}
          node.remove();
          return;
        }

        if(y > window.innerHeight + 180){
          node.remove();
        }
      });

      if(running) requestAnimationFrame(tick);
    }

    let clickedWrongWords = [];

    function clearWordsAndFloats(){
      [...document.querySelectorAll('.word,.float')].forEach(el => el.remove());
    }

    function startGame(){
      running = true;
      ended = false;
      overlay.classList.remove('show');

      const L = LEVELS[selectedLevel];
      const titleEl = document.getElementById('startTitle');
      if (titleEl) titleEl.textContent = L.mission || `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${L.name}`;
      if (ruleLabelEl) ruleLabelEl.textContent = L.ruleText;

      lastRunScore = 0;
      updateAccum();

      const sumEl = document.getElementById('accumSummary');
      if(sumEl) sumEl.style.display = 'none';

      refillPool();

      setGauge(0);
      clickedWrongWords = [];
      if (wrongListEl) wrongListEl.innerHTML = '';
      if (wrongBoxEl)  wrongBoxEl.style.display = 'none';
      clearWordsAndFloats();
      placeKid();

      try { playBgm(); } catch(e){}

      remain = stageSeconds;
      timerEl.textContent = fmt(remain);
      if(countdown) clearInterval(countdown);
      countdown = setInterval(() => {
        if(!running) return;
        remain--;
        timerEl.textContent = fmt(remain);
        if(remain <= 0){ endGame('time'); }
      }, 1000);

      if(spawner) clearInterval(spawner);
      spawner = setInterval(spawnWord, 700);

      lastTime = performance.now();
      requestAnimationFrame(tick);
    }

    function endGame(reason='time'){
      if (ended) return;
      ended = true;
      running = false;
      clearInterval(countdown);
      clearInterval(spawner);
      finalScoreEl.textContent = gauge.toString();

      lastRunScore = gauge;
      endTitleEl.textContent = (reason === 'win') ? '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° üéâ' : '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!';

      if (wrongListEl){
        if (clickedWrongWords.length === 0){
          if (wrongBoxEl) wrongBoxEl.style.display = 'none';
        } else {
          const seen = new Set();
          const unique = clickedWrongWords.filter(w => (seen.has(w) ? false : (seen.add(w), true)));
          wrongListEl.innerHTML = unique.map(w => `<span class="chip">${w}</span>`).join('');
          if (wrongBoxEl) wrongBoxEl.style.display = 'block';
        }
      }

      try{ if (theWin) { theWin.currentTime = 0; theWin.play().catch(()=>{}); } }catch(e){}
      try{ if(bgm){ bgm.pause(); bgm.currentTime = 0; } }catch(e){}

      refreshNextButton();
      overlay.classList.add('show');
    }

    window.addEventListener('keydown', (e) => {
      if(!running) return;
      const k = e.key.toLowerCase();
      if(k === 'arrowleft' || k === 'a'){ kidLane = Math.max(0, kidLane-1); placeKid(); }
      else if(k === 'arrowright' || k === 'd'){ kidLane = Math.min(2, kidLane+1); placeKid(); }
    });

    game.addEventListener('click', (e) => {
      if(!running) return;
      const x = e.clientX, w = window.innerWidth;
      if(x < w/3) kidLane = 0; else if(x < (2*w/3)) kidLane = 1; else kidLane = 2;
      placeKid();
    });

    window.addEventListener('resize', placeKid);

    restartBtn.addEventListener('click', () => { startGame(); });

    selectLevelBtn.addEventListener('click', () => {
      overlay.classList.remove('show');
      clearWordsAndFloats();
      cumulativeScore = 0; roundsPlayed = 0; lastRunScore = 0; updateAccum();
      const landing = document.getElementById('landing');
      const startScreen = document.getElementById('startScreen');
      if (landing){ landing.classList.remove('hide'); }
      if (startScreen){ startScreen.style.display = 'none'; }
    });

    nextLevelBtn.addEventListener('click', () => {
      if (roundsPlayed < 3) {
        cumulativeScore += lastRunScore; roundsPlayed++; updateAccum();
        selectedLevel = (selectedLevel + 1) % LEVELS.length;
        overlay.classList.remove('show');
        openStartForLevel(true);
        return;
      }
      if (roundsPlayed === 3) {
        cumulativeScore += lastRunScore; roundsPlayed++; updateAccum();
        const sumEl = document.getElementById('accumSummary');
        const totalEl = document.getElementById('accumTotal');
        if (sumEl && totalEl){ totalEl.textContent = cumulativeScore.toString(); sumEl.style.display = 'block'; }
        endTitleEl.textContent = '‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°';
        finalScoreEl.textContent = lastRunScore.toString();
        refreshNextButton();
        return;
      }
    });

    /* ‚úÖ API ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ Landing ‡πÉ‡∏ä‡πâ + ‡∏£‡∏∞‡∏ö‡∏ö motion ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏•‡∏ô‡πÑ‡∏î‡πâ */
    window.__GAME__ = {
      startGame,
      setSelectedLevel: (i)=>{ selectedLevel = i|0; },
      getLevel: (i)=> LEVELS[i],
      getMissionFor: (i)=> (LEVELS[i] && LEVELS[i].mission) ? LEVELS[i].mission : '',
      moveLane: (lane)=>{ if([0,1,2].includes(lane)){ kidLane = lane; placeKid(); } },
      __isRunning: () => running,
      getLane: () => kidLane
    };

    /* Pause / Resume */
    let paused = false;
    function pauseGame(){ if (!running) return; paused = true; running = false; clearInterval(countdown); clearInterval(spawner); }
    function resumeGame(){
      if (!paused) return; paused = false; running = true;
      lastTime = performance.now();
      countdown = setInterval(() => {
        if(!running) return;
        remain--;
        timerEl.textContent = fmt(remain);
        if(remain <= 0){ endGame('time'); }
      }, 1000);
      spawner = setInterval(spawnWord, 700);
      requestAnimationFrame(tick);
    }
    const pauseBtn = document.getElementById('pauseBtn');
    if(pauseBtn){
      pauseBtn.addEventListener('click', ()=>{
        if(!paused){ pauseGame(); pauseBtn.textContent = '‚ñ∂Ô∏è ‡∏ï‡πà‡∏≠'; }
        else{ resumeGame(); pauseBtn.textContent = '‚è∏ ‡∏´‡∏¢‡∏∏‡∏î'; }
      });
    }
    const quickHome = document.getElementById('quickRestart');
if(quickHome){
  quickHome.addEventListener('click', ()=>{
    // ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏ö‡∏ö‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•: ‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î ‚Üí ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà
    if (running) {
      pauseGame();
      running = false;
    }
    ended = false;
    clearInterval(countdown);
    clearInterval(spawner);
    overlay.classList.remove('show');
    clearWordsAndFloats();

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï UI
    const startScreen = document.getElementById('startScreen');
    const landing     = document.getElementById('landing');
    if (startScreen) startScreen.style.display = 'none';
    if (landing) landing.classList.remove('hide');

    // (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ uncomment ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á:
    // cumulativeScore = 0; roundsPlayed = 0; lastRunScore = 0; updateAccum();
  });
}

})();
  </script>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°: ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á -->
<script>
(function(){
  const startScreen = document.getElementById('startScreen');
  const startBtn    = document.getElementById('startBtn');
  const countdownEl = document.getElementById('countdown');
  const restartBtn  = document.getElementById('restartBtn');

  if(!startScreen || !startBtn || !countdownEl || !restartBtn) return;

  let starting = false; // ‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á

  function startCountdown(){
    if (starting) return;
    starting = true;

    let n = 3;
    countdownEl.textContent = n;
    countdownEl.style.display = 'block';
    const itv = setInterval(() => {
      n--;
      if(n > 0){
        countdownEl.textContent = n;
      }else{
        clearInterval(itv);
        startScreen.style.display = 'none';
        // ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° üì∑ ‡πÄ‡∏≠‡∏á)
if(window.__GAME__) window.__GAME__.startGame();
        starting = false; // ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
      }
    }, 1000);
  }

  startBtn.addEventListener('click', () => {
    startBtn.style.display = 'none';
    startCountdown();
  });

  restartBtn.addEventListener('click', () => {
  if(window.__GAME__) window.__GAME__.startGame();
});
})();
</script>

  <!-- Landing interactions -->
  <script>
  (function(){
    const landing     = document.getElementById('landing');
    const levelBtns   = document.querySelectorAll('.levelBtn');
    const startScreen = document.getElementById('startScreen');
    const startTitle  = document.getElementById('startTitle');

    levelBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const idx = parseInt(btn.getAttribute('data-level'),10);
        if (Number.isNaN(idx)) return;

        if(window.__GAME__ && window.__GAME__.setSelectedLevel){
          window.__GAME__.setSelectedLevel(idx);
        }
        const L = (window.__GAME__ && window.__GAME__.getLevel) ? window.__GAME__.getLevel(idx) : null;
        startTitle.textContent = (L && L.mission) ? L.mission : `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${btn.textContent}`;

        landing.classList.add('hide');
        startScreen.style.display = 'flex';
        const startBtn = document.getElementById('startBtn');
        if(startBtn) { startBtn.style.display = 'inline-block'; }
        const countdownEl = document.getElementById('countdown');
        if(countdownEl){ countdownEl.style.display = 'none'; }
      });
    });

    const guideBtn  = document.getElementById('guideBtn');
    const guide     = document.getElementById('guideScreen');
    const guideBack = document.getElementById('guideBack');

    if (guideBtn && guide){
      guideBtn.addEventListener('click', ()=>{
        landing.classList.add('hide');
        guide.style.display = 'flex';
      });
    }
    if (guideBack && guide){
      guideBack.addEventListener('click', ()=>{
        guide.style.display = 'none';
        landing.classList.remove('hide');
      });
    }
  })();
  </script>

</body>
</html>




